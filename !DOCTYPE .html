<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barbería Galaxy - Reservas Profesionales</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #fff; padding: 20px; }
  h1,h2 { color: #0ff; text-align: center; }
  .container { max-width: 600px; margin: auto; background: #222; padding: 20px; border-radius: 15px; box-shadow: 0 0 15px #0ff; }
  label, input, select, button { display: block; width: 100%; margin-top: 10px; padding: 10px; border-radius: 8px; border: none; }
  button { background: #0ff; color: #111; font-weight: bold; cursor: pointer; }
  .success { color: #0f0; margin-top: 10px; text-align: center; }
  .error { color: #f00; margin-top: 10px; text-align: center; }
  .link-box { background: #333; padding: 10px; border-radius: 10px; margin-top: 15px; word-break: break-all; text-align: center; }
  .available-times { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px; }
  .available-times button { width: auto; padding: 5px 10px; cursor: pointer; border-radius: 5px; }
  .available-times button.taken { background: #555; cursor: not-allowed; color: #999; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { padding: 8px; border: 1px solid #0ff; text-align: center; }
  th { background: #0aa; }
</style>
</head>
<body>

<div class="container">
  <h1>Barbería Galaxy</h1>

  <form id="bookingForm">
    <label for="name">Nombre *</label>
    <input type="text" id="name" required>

    <label for="phone">Teléfono *</label>
    <input type="tel" id="phone" required pattern="[0-9]{8,15}" title="Introduce un número válido">

    <label for="service">Servicio *</label>
    <select id="service" required>
      <option value="">Selecciona un servicio</option>
      <option value="Corte de cabello">Corte de cabello</option>
      <option value="Afeitado">Afeitado</option>
      <option value="Barba completa">Barba completa</option>
      <option value="Corte + Barba">Corte + Barba</option>
    </select>

    <label for="date">Fecha *</label>
    <input type="date" id="date" required min="">
    
    <div class="available-times" id="timeSlots"></div>
    <input type="hidden" id="time">

    <button type="submit">Reservar Cita</button>
  </form>

  <div id="message" class="success"></div>
  <div id="link" class="link-box"></div>
</div>

<div class="container">
  <h2>Panel Administrativo</h2>
  <table id="adminTable">
    <thead>
      <tr>
        <th>Nombre</th><th>Teléfono</th><th>Servicio</th><th>Fecha</th><th>Hora</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const form = document.getElementById('bookingForm');
const message = document.getElementById('message');
const linkBox = document.getElementById('link');
const dateInput = document.getElementById('date');
const timeSlotsDiv = document.getElementById('timeSlots');
const adminTableBody = document.querySelector('#adminTable tbody');

const availableTimes = ["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00"];
const today = new Date().toISOString().split('T')[0];
dateInput.min = today;

dateInput.addEventListener('change', showAvailableTimes);

function showAvailableTimes() {
  timeSlotsDiv.innerHTML = '';
  const date = dateInput.value;
  if(!date) return;

  const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
  availableTimes.forEach(time => {
    const taken = bookings.some(b => b.date === date && b.time === time);
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.textContent = time;
    btn.className = taken ? 'taken' : '';
    btn.disabled = taken;
    btn.addEventListener('click', () => document.getElementById('time').value = time);
    timeSlotsDiv.appendChild(btn);
  });
}

function updateAdminTable() {
  const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
  adminTableBody.innerHTML = '';
  bookings.forEach(b => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${b.name}</td><td>${b.phone}</td><td>${b.service}</td><td>${b.date}</td><td>${b.time}</td>`;
    adminTableBody.appendChild(row);
  });
}

form.addEventListener('submit', function(e) {
  e.preventDefault();
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const service = document.getElementById('service').value;
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;

  if(!name || !phone || !service || !date || !time){
    message.textContent = "Completa todos los campos.";
    message.className = "error";
    return;
  }

  let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
  if(bookings.find(b => b.date === date && b.time === time)){
    message.textContent = "Hora ocupada. Elige otra.";
    message.className = "error";
    return;
  }

  const id = 'booking-' + Date.now();
  const booking = { id, name, phone, service, date, time };
  bookings.push(booking);
  localStorage.setItem('bookings', JSON.stringify(bookings));

  message.textContent = "¡Cita reservada con éxito!";
  message.className = "success";
  form.reset();
  timeSlotsDiv.innerHTML = '';

  const url = `${window.location.origin}${window.location.pathname}?id=${id}`;
  linkBox.textContent = "Enlace de cita: " + url;

  // Notificación WhatsApp (abre chat con número y mensaje)
  const text = encodeURIComponent(`Hola ${name}, tu cita en Barbería Galaxy para ${service} es el ${date} a las ${time}.`);
  const whatsappUrl = `https://wa.me/${phone}?text=${text}`;
  window.open(whatsappUrl, '_blank');

  updateAdminTable();
});

// Mostrar cita si se accede con enlace
const params = new URLSearchParams(window.location.search);
if(params.has('id')){
  const id = params.get('id');
  const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
  const booking = bookings.find(b => b.id === id);
  if(booking){
    message.textContent = `Hola ${booking.name}, tienes cita para ${booking.service} el ${booking.date} a las ${booking.time}.`;
    message.className = "success";
  }
}

updateAdminTable();
</script>

</body>
</html>
